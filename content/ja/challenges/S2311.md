+++
title = 'DuoでのBaby LLaMA 2の速度最適化（子供向けお話しシナリオ）'
date = 2023-11-27T19:57:09+08:00
toc = true
slug = 'S2311'
cid = 'S2311'
award = '20000 CNY'
summary = 'Milk-V Duoのような小型のボードでBaby LLaMA 2を実行することは大きな挑戦です。このコンテストの目的は、Milk-V Duoプラットフォーム上でのBaby LLaMA 2の性能を向上させることであり、目標は毎秒トークン処理速度を高めることです。参加者は軽量技術とコンパイラ最適化戦略を活用し、マイクロフォンの音声入力やコマンドラインの入力プロンプトなど、さまざまな方法を組み合わせて、物語を語るロボットのデモを開発する必要があります。このデモはスピーカーを通じて出力され、小米米兔のお話しロボットのプロトタイプデザインを参考にすることができます。'
+++

## プロジェクトの説明：

Milk-V Duoのような小型のボードでBaby LLaMA 2を実行することは大きな挑戦です。このコンテストの目的は、Milk-V Duoプラットフォーム上でのBaby LLaMA 2の性能を向上させることであり、目標は毎秒トークン処理速度を高めることです。参加者は軽量技術とコンパイラ最適化戦略を活用し、マイクロフォンの音声入力やコマンドラインの入力プロンプトなど、さまざまな方法を組み合わせて、物語を語るロボットのデモを開発する必要があります。このデモはスピーカーを通じて出力され、小米米兔のお話しロボットのプロトタイプデザインを参考にすることができます。

## 成果物および評価要件：

1. 評価基準は正確性と性能の2つの面に焦点を当てます。同じ入力に対して、基準テストを用いて参加作品の正確性と性能を評価します。
2. 正確性のスコアリングは、参加作品の出力と基準出力の差分テスト結果を用いて測定し、最適化技術がモデル推論の精度に与える影響を反映します。性能スコアリングは、毎秒計算されるトークンの数を用いて測定し、参加作品の性能最適化効果を直接反映します。
3. テキストから音声への変換（TTS）の時間は別途計算されます。
4. 最終的に、委員会は参加作品の正確性と性能の全体的なパフォーマンスに基づいて評価し、両者はコンテストの評価委員会が設定した加重比率に基づいて最終スコアを算出し、最高得点を獲得した参加者が勝者となります。

**検証プラットフォーム： Duo**

## Repository for submissions

- https://github.com/plctlab/rvspoc-s2311-llama2

## 提交说明

* 提交仓库链接为 https://github.com/plctlab/rvspoc-s2311-llama2
* 请以 Pull Request 的形式，将结果提交到上述仓库中。
* 提交时，请详细说明复现所需要的软件环境，可以参照「验收说明」内默认软件环境做修改。
* 在比赛期间，所有经过优化过的内容的提交方式可以有：
  1. 二进制的形式
  2. 加密源码的形式（加密信息需通过邮件发送至 rvspoc@cyberlimes.cn）
  3. 源码形式
* 最终结果公布后，需对提交内容进行完整开源。
* 组委会会在比赛结束后（即 2024 年 2 月 16 日以后），关闭赛题仓库的 Pull Request 通道，并开始对结果进行验收。

## 验收说明

1. 验收平台为 **Milk-V Duo**， **64M** 版本，
   - 同规格 TF 卡
   - 不使用 Swap 文件/分区
   - 不进行 CPU 超频
   - 无额外散热
2. 对 Duo 上的系统**不限**
3. Baby Llama 2 对应的仓库为： https://github.com/karpathy/llama2.c
4. 组委会会在条件 1 的基础上，使用如下软件环境，将经过多次跑分所产生的平均值作为基线，与选手优化过后的数据进行比较：
   1. Baby Llama 2 二进制使用上述仓库下原始未修改 C 文件以 `-Ofast` 所编译的。
   2. 编译器使用 Milk-V 官方提供的交叉编译工具链（版本待定）
   3. 系统使用默认的 Milk-V Duo 系统镜像（版本待定）
   4. 统一的输入及参数（具体待定）
   5. 以下大语言模型文件：
      * 针对纯 FP32 推理（即使用 run.c 文件），使用 Baby LLama 2 仓库下提供的 15M 规模参数的模型（纯 FP32 模型）
      * 其 sha256sum 为：cd590644d963867a2b6e5a1107f51fad663c41d79c149fbecbbb1f95fa81f49a
6. 正确性评定说明：因为针对固定输入参数（确定随机数的），输出内容为固定值，所以组委会将会与在条件 4 下生成的 run.c 二进制所输出内容进行比对，如果产生差异，会以人类常用语法进行判断，语法正确不扣分，语法错误扣分，扣分比例待定。
7. 性能评定说明：每个提交结果，会运行 30 次，在去掉有明显差异的最高分和最低分后，取平均值记录。
8. 如果完成了文本转语音（TTS）功能，则根据实现程度，额外加分，加分比例待定。
9. 最后给出的结果，会有针对每一项的详细说明。
10. **根据赛题的实际优化进展，针对未考虑到的方面，随着比赛进程的推进可能会有调整，请保持对赛事网站的关注，最终解释权归属于比赛的赛题评审委员会。**

## 知的財産権およびオープンソースライセンスに関する説明：

すべての参加成果はオープンソースとして公開し、主催者が指定するリポジトリに提出する必要があります。参加者（著者）は作品の全ての権利を保有します。主催者は、参加者が成果をアップストリームにフィードバックして貢献することを奨励します。

## Resources

* Live Replay & Documents (Chinese)： [plctlab/rvspoc:Docs/S2311](https://github.com/plctlab/rvspoc/tree/main/Docs/S2311)
