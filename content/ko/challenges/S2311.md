+++
title = 'Duo에서 Baby LLaMA 2의 속도 최적화 (어린이용 이야기 시나리오)'
date = 2023-11-27T19:57:09+08:00
toc = true
slug = 'S2311'
cid = 'S2311'
award = '20000 CNY'
summary = 'Milk-V Duo와 같은 작은 보드에서 Baby LLaMA 2를 실행하는 것은 큰 도전입니다. 이 대회의 목적은 Milk-V Duo 플랫폼에서 Baby LLaMA 2의 성능을 향상시키는 것이며, 목표는 초당 토큰 처리 속도를 높이는 것입니다. 참가자들은 경량 기술과 컴파일러 최적화 전략을 활용하여, 마이크로폰의 음성 입력이나 커맨드 라인 입력 프롬프트 등 다양한 방법을 결합하여 이야기를 들려주는 로봇의 데모를 개발해야 합니다. 이 데모는 스피커를 통해 출력되며, 샤오미 미토 이야기 로봇의 프로토타입 디자인을 참조할 수 있습니다.'
+++

## 프로젝트 설명：

Milk-V Duo와 같은 작은 보드에서 Baby LLaMA 2를 실행하는 것은 큰 도전입니다. 이 대회의 목적은 Milk-V Duo 플랫폼에서 Baby LLaMA 2의 성능을 향상시키는 것이며, 목표는 초당 토큰 처리 속도를 높이는 것입니다. 참가자들은 경량 기술과 컴파일러 최적화 전략을 활용하여, 마이크로폰의 음성 입력이나 커맨드 라인 입력 프롬프트 등 다양한 방법을 결합하여 이야기를 들려주는 로봇의 데모를 개발해야 합니다. 이 데모는 스피커를 통해 출력되며, 샤오미 미토 이야기 로봇의 프로토타입 디자인을 참조할 수 있습니다.

## 결과물 및 평가 요건：

1. 평가 기준은 정확도와 성능의 두 가지 측면에 초점을 맞춥니다. 동일한 입력에 대해 기준 테스트를 사용하여 참가 작품의 정확도와 성능을 평가합니다.
2. 정확도 점수는 참가 작품의 출력과 기준 출력의 차이 테스트 결과를 사용하여 측정하며, 최적화 기술이 모델 추론의 정확도에 미치는 영향을 반영합니다. 성능 점수는 초당 계산되는 토큰의 수를 사용하여 측정하며, 참가 작품의 성능 최적화 효과를 직접 반영합니다.
3. 텍스트에서 음성으로의 변환(TTS) 시간은 별도로 계산됩니다.
4. 최종적으로, 위원회는 참가 작품의 정확도와 성능의 전체적인 성능을 기반으로 평가하고, 두 가지는 대회의 평가 위원회가 설정한 가중치 비율에 따라 최종 점수를 계산하여, 최고 점수를 획득한 참가자가 승자가 됩니다.

**검증 플랫폼: Duo**

## Repository for submissions

- https://github.com/plctlab/rvspoc-s2311-llama2

## 提交说明

* 提交仓库链接为 https://github.com/plctlab/rvspoc-s2311-llama2
* 请以 Pull Request 的形式，将结果提交到上述仓库中。
* 提交时，请详细说明复现所需要的软件环境，可以参照「验收说明」内默认软件环境做修改。
* 在比赛期间，所有经过优化过的内容的提交方式可以有：
  1. 二进制的形式
  2. 加密源码的形式（加密信息需通过邮件发送至 rvspoc@cyberlimes.cn）
  3. 源码形式
* 最终结果公布后，需对提交内容进行完整开源。
* 组委会会在比赛结束后（即 2024 年 2 月 16 日以后），关闭赛题仓库的 Pull Request 通道，并开始对结果进行验收。

## 验收说明

1. 验收平台为 **Milk-V Duo**， **64M** 版本，
   - 同规格 TF 卡
   - 不使用 Swap 文件/分区
   - 不进行 CPU 超频
   - 无额外散热
2. 对 Duo 上的系统**不限**
3. Baby Llama 2 对应的仓库为： https://github.com/karpathy/llama2.c
4. 组委会会在条件 1 的基础上，使用如下软件环境，将经过多次跑分所产生的平均值作为基线，与选手优化过后的数据进行比较：
   1. Baby Llama 2 二进制使用上述仓库下原始未修改 C 文件以 `-Ofast` 所编译的。
   2. 编译器使用 Milk-V 官方提供的交叉编译工具链（版本待定）
   3. 系统使用默认的 Milk-V Duo 系统镜像（版本待定）
   4. 统一的输入及参数（具体待定）
   5. 以下大语言模型文件：
      * 针对纯 FP32 推理（即使用 run.c 文件），使用 Baby LLama 2 仓库下提供的 15M 规模参数的模型（纯 FP32 模型）
      * 其 sha256sum 为：cd590644d963867a2b6e5a1107f51fad663c41d79c149fbecbbb1f95fa81f49a
6. 正确性评定说明：因为针对固定输入参数（确定随机数的），输出内容为固定值，所以组委会将会与在条件 4 下生成的 run.c 二进制所输出内容进行比对，如果产生差异，会以人类常用语法进行判断，语法正确不扣分，语法错误扣分，扣分比例待定。
7. 性能评定说明：每个提交结果，会运行 30 次，在去掉有明显差异的最高分和最低分后，取平均值记录。
8. 如果完成了文本转语音（TTS）功能，则根据实现程度，额外加分，加分比例待定。
9. 最后给出的结果，会有针对每一项的详细说明。
10. **根据赛题的实际优化进展，针对未考虑到的方面，随着比赛进程的推进可能会有调整，请保持对赛事网站的关注，最终解释权归属于比赛的赛题评审委员会。**

## 지적 재산권 및 오픈 소스 라이선스에 관한 설명：

모든 참가 작품은 오픈 소스로 공개되어야 하며, 주최자가 지정하는 저장소에 제출해야 합니다. 참가자(저자)는 작품의 모든 권리를 보유합니다. 주최자는 참가자가 결과물을 업스트림에 피드백하여 기여하는 것을 권장합니다.

## Resources

* Live Replay & Documents (Chinese)： [plctlab/rvspoc:Docs/S2311](https://github.com/plctlab/rvspoc/tree/main/Docs/S2311)
